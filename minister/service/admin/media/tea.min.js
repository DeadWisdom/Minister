
var Tea={root:''};Tea.require=function()
{for(var i=0;i<arguments.length;i++)
{var src=Tea.root+arguments[i];if(Tea.require.map[src])
return;Tea.require.map[src]=true;try{extension=src.match(/.*?\.(js|css)/i)[1];}catch(e){throw"Can only import .css or .js files, not whatever this is: "+src;}
if(extension=='js')
document.write('<script type="text/javascript" src="'+src+'"></script>\n');else if(extension=='css')
document.write('<link rel="stylesheet" href="'+src+'" type="text/css"/>\n');}}
Tea.require.map={}
jQuery.fn.be=function(type,options)
{var options=options||{};options.source=this;if(typeof type=='string')type=Tea.getClass(type);var obj=new type(options);obj.render();return obj;}
Tea.classes={};Tea.registerClass=function(name,type){Tea.classes[name]=type}
Tea.getClass=function(cls)
{if(typeof cls=='function')return cls;return Tea.classes[cls];}
Tea.isInstance=function(instance,cls)
{if(!cls.prototype)return false;for(var p=cls.prototype;p.supertype;p=p.supertype)
if(p.constructor==cls)
return true;return false;}
Tea.overrideMethod=function(super_func,func)
{return function()
{this.__super__=function(){return super_func.apply(this,arguments)};var r=func.apply(this,arguments);delete this.__super__;return r;}}
Tea.manifest=function(obj,search_space)
{if(search_space==null)search_space=Tea.classes;if(typeof obj=='string')return new search_space[obj]();if(typeof obj=='function')return new obj();if(obj.constructor!=Object)return obj;var cls=obj.type;if(typeof cls=='string')
cls=search_space[cls];if(!cls)
{throw new Error("Unable to instantiate object: "+cls);}
return new cls(obj);}
Tea.Object=function(){this.__init__.apply(this,arguments);}
Tea.registerClass('Tea.Object',Tea.Object);Tea.Object.prototype.__init__=function(options){Tea.Object.setOptions(this,options)
if(this.onInit)
this.onInit.apply(this,arguments);};Tea.Object.setOptions=function(instance,options){jQuery.extend(instance,instance.constructor.prototype.options,options)};Tea.Object.__subclass__=function(base,name,extra)
{if(extra==undefined&&typeof name!='string')
{extra=name;name=null}
var sub=function(){if(typeof(this.__init__)!='function')
throw"You probably tried to create a Tea object without using the 'new' keyword.  e.g. var object = Tea.Object() should be var object = new Tea.Object()."
this.__init__.apply(this,arguments);}
jQuery.extend(sub.prototype,base.prototype,extra);for(k in base.prototype)
{if(typeof(base.prototype[k])=='function'&&typeof(sub.prototype[k])=='function')
{sub.prototype[k]=Tea.overrideMethod(base.prototype[k],sub.prototype[k]);}}
sub.supertype=base.prototype;sub.prototype.options=jQuery.extend({},base.prototype.options,extra.options);sub.subclass=function(name,inner_extra)
{return sub.__subclass__(sub,name,inner_extra);}
sub.extend=function(interface)
{if(interface.prototype)
interface=interface.prototype;var options=sub.prototype.options;jQuery.extend(sub.prototype,interface);if(interface.options)
sub.prototype.options=jQuery.extend(options,interface.options);return sub;}
sub.extendClass=function(interface)
{jQuery.extend(sub,interface);return sub;}
if(name)
{Tea.registerClass(name,sub);sub.id=name||'unnamed';}
sub.__subclass__=base.__subclass__;return sub;}
Tea.Object.subclass=function(name,extra){return Tea.Object.__subclass__(Tea.Object,name,extra)}
Tea.Object.prototype.toString=function()
{return"<"+this.constructor.id+">";},Tea.Object.prototype.bind=function(event,handler,args)
{if(!this.__events)this.__events={};if(!this.__events[event])this.__events[event]=[];this.__events[event].push([handler,args]);};Tea.Object.prototype.unbind=function(event,handler){if(!this.__events)return;var handlers=this.__events[event];if(!handlers)return;if(handler)
{jQuery.each(handlers,function(i)
{if(this[0]==handler)
{handlers.splice(i,1);}});}
else
{delete this.__events[event];}};Tea.Object.prototype.trigger=function(event,args){if(!this.__events)return;var handlers=this.__events[event];if(!handlers)return;if(!args)args=[];for(var i=0;i<handlers.length;i++)
{handlers[i][0].apply(this,(handlers[i][1]||[]).concat(args));}};Tea.Class=function(){return Tea.Object.subclass.apply(this,arguments);}
Tea.Application=Tea.Class('Tea.Application',{__init__:function(properties){if(properties)
$.extend(this,properties);},setup:function(properties)
{if(properties)
$.extend(this,properties);var self=this;$(function(){self.ready.call(self)});},ready:function(properties){}})
Tea.routes={};Tea.getRoute=function(name)
{return Tea.routes[name];}
Tea.route=function(name,url)
{if(typeof name=='object')
jQuery.extend(Tea.routes,name);else
Tea.routes[name]=url;}
Tea.toJSON=function(o)
{if(JSON&&JSON.stringify)
return JSON.stringify(o);var type=typeof(o);if(o===null)
return"null";if(type=="undefined")
return undefined;if(type=="number"||type=="boolean")
return o+"";if(type=="string")
return Tea.quoteString(o);if(type=='object')
{if(typeof o.toJSON=="function")
return Tea.toJSON(o.toJSON());if(o.constructor===Date)
{var month=o.getUTCMonth()+1;if(month<10)month='0'+month;var day=o.getUTCDate();if(day<10)day='0'+day;var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10)hours='0'+hours;var minutes=o.getUTCMinutes();if(minutes<10)minutes='0'+minutes;var seconds=o.getUTCSeconds();if(seconds<10)seconds='0'+seconds;var milli=o.getUTCMilliseconds();if(milli<100)milli='0'+milli;if(milli<10)milli='0'+milli;return'"'+year+'-'+month+'-'+day+'T'+
hours+':'+minutes+':'+seconds+'.'+milli+'Z"';}
if(o.constructor===Array)
{var ret=[];for(var i=0;i<o.length;i++)
ret.push(Tea.toJSON(o[i])||"null");return"["+ret.join(",")+"]";}
var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number")
name='"'+k+'"';else if(type=="string")
name=Tea.quoteString(k);else
continue;if(typeof o[k]=="function")
continue;var val=Tea.toJSON(o[k]);pairs.push(name+":"+val);}
return"{"+pairs.join(", ")+"}";}};Tea.evalJSON=function(src)
{if(JSON&&JSON.parse)
return JSON.parse(src);return eval("("+src+")");};Tea.secureEvalJSON=function(src)
{if(JSON&&JSON.parse)
return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,'@');filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']');filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,'');if(/^[\],:{}\s]*$/.test(filtered))
return eval("("+src+")");else
throw new SyntaxError("Error parsing JSON, source is not valid.");};Tea.quoteString=function(string)
{if(Tea.quoteString.escapeable.test(string))
{return'"'+string.replace(Tea.quoteString.escapeable,function(a)
{var c=Tea.quoteString.meta[a];if(typeof c==='string')return c;c=a.charCodeAt();return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}
return'"'+string+'"';};Tea.quoteString.escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;Tea.quoteString.meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'};Tea.ajax=function(options,overriding)
{var options=jQuery.extend({},Tea._ajax_default,options,overriding);var route=Tea.getRoute(options.url);if(route)
options.url=route;if(options.post){options.method='post';options.data=options.post;}
else if(options.get){options.method='get';options.data=options.get;}
var success=options.success;var failure=options.failure;var invalid=options.invalid;var context=options.context;options.success=function(response)
{if(response&&response.__errors__&&invalid){return invalid.call(context,response);}
if(success)
return success.call(context,response);}
if(failure)
options.error=function(response)
{return failure.apply(context);}
options.type=options.method;delete options.method;delete options.context;return jQuery.ajax(options);}
Tea._ajax_default={url:null,method:'get',data:{},dataType:'json',context:null,};Tea.deselect=function()
{if(document.selection)
document.selection.empty();else if(window.getSelection)
window.getSelection().removeAllRanges();}
Tea.method=function(func,context)
{return function(){return func.apply(context,arguments);}}
Tea.latent=function(milliseconds,func,context)
{var timeout=null;var args=null;function call()
{clearTimeout(timeout);timeout=null;func.apply(context,args);}
function refresh(new_milliseconds)
{milliseconds=new_milliseconds||milliseconds;if(timeout)
clearTimeout(timeout);timeout=setTimeout(call,milliseconds)}
function cancel()
{if(timeout)
clearTimeout(timeout);timeout=null;}
var self=function()
{args=arguments;refresh();}
self.call=call;self.refresh=refresh;self.cancel=cancel;return self;}
Tea.Element=Tea.Class('Tea.Element',{options:{source:'<div/>',skin:null,id:null,html:null,cls:null,hidden:false,behaviors:[],attrs:{}},__init__:function(options){this.__rendered=false;this.__super__(options);this.parent=null;var skin=this.skin;if(typeof skin=='string')
this.skin=new(Tea.getClass(skin))(this);else if(typeof skin=='function')
this.skin=new skin(this);else if(skin==null)
{var skinCls=null;var cls=this.constructor;while(!skinCls&&cls&&cls!=Tea.Object)
{skinCls=Tea.classes[cls.id+'.Skin'];cls=cls.supertype.constructor;}
if(skinCls)
this.skin=new skinCls(this);else
throw new Error("Element.skin is set to null, but no skin can be found.");}
else
throw new Error("Element.skin must be set to null, a function, or a string which cooresponds to a Skin class.");},render:function(source){if(this.__rendered)return this.source;if(source)
this.source=this.skin.render($(source));else
this.source=this.skin.render();if(this.__latentBinds)
for(var i in this.__latentBinds)
this.addEventListener.apply(this,this.__latentBinds[i]);var behaviors=this.behaviors;if(behaviors&&behaviors.length>0)
for(var i=0;i<behaviors.length;i++)
this.addBehavior(behaviors[i]);this.onRender();this.__rendered=true;return this.source;},onRender:function()
{},isRendered:function()
{return this.__rendered;},remove:function()
{if(this.parent)
this.parent.remove(this);else
this.source.remove();this.trigger('remove',this,this.parent);},addEventListener:function(type,handle)
{if(!this.__rendered)
{if(!this.__latentBinds)
this.__latentBinds=[];return this.__latentBinds.push([type,handle]);}
for(var i=0;i<this.source.length;i++)
{var elem=this.source[i];if(elem.addEventListener)
elem.addEventListener(type,handle,false);else if(elem.attachEvent)
elem.attachEvent("on"+type,handle);}},addBehavior:function(b)
{if(b.constructor===Object)
{var cls=Tea.classes[b.type];if(!cls)
throw new Error("Attempt to add behavior to this element, an Object instance with no valid type: "+item.type);b=new cls(b);}
b.attach(this);},hide:function()
{this.setHidden(true);},show:function()
{this.setHidden(false);},setHidden:function(flag)
{if(this.__rendered)
this.skin.setHidden(flag);else
this.hidden=flag;},setHTML:function(html)
{if(this.__rendered)
this.skin.setHTML(html)
else
this.html=html;}});Tea.Element.Skin=Tea.Object.subclass('Tea.Element.Skin',{options:{},__init__:function(element)
{this.__super__();this.element=element;this.source=element.source;},render:function(source){var element=this.element;var source=this.source=element.source=$(source||element.source);if(element.id)source.attr('id',element.id);if(element.cls)source.addClass(element.cls);if(this.cls)source.addClass(this.cls);if(element.html)this.setHTML(element.html);if(element.attrs)
for(a in element.attrs)
source.attr(a,element.attrs[a]);if(element.style)
for(var i in element.style)
source.css(i,element.style[i]);if(element.hidden)
source.hide();return source;},remove:function(){this.source.remove();},setHTML:function(src)
{this.source.empty().append(src);},setHidden:function(flag)
{if(flag)
this.source.hide();else
this.source.show();}})
Tea.Container=Tea.Element.subclass('Tea.Container',{options:{items:null},__init__:function(options)
{this.__super__(options);var items=jQuery.makeArray(this.items);this.items=[];var container=this;jQuery.each(items,function(){container.append(this);})},own:function(item)
{if(item.constructor===Object)
{var cls=Tea.classes[item.type];if(!cls&&this.classes)
cls=this.classes[item.type];if(!cls)
throw new Error("Attempt to add to this container, an Object instance with no valid type: "+item.type);item=new cls(item);}
if(item.parent)
item.remove();item.parent=this;return item;},append:function(item)
{item=this.own(item);item._index=this.items.length;this.items.push(item);if(this.isRendered())
this.skin.append(item.render());return item;},insert:function(pos,item)
{if(typeof pos!='number')throw new Error("Recieved a non-number for the 'pos' argument in insert(pos, item).");if(pos>=this.items.length)
return this.append(item);item=this.own(item);this.items.splice(pos,0,item);for(var i=0;i<this.items.length;i++)
this.items[i]._index=i;if(this.isRendered())
{if(item._index==0)
this.skin.prepend(item.render())
else
this.skin.after(this.items[item._index-1].source,item.render());}
return item;},prepend:function(item)
{return this.insert(0,item);},remove:function(item)
{if(!item)return Tea.Container.supertype.remove.call(this);if(item.parent!==this)return;this.items.splice(item._index,1);if(item.isRendered())
item.skin.remove();item.parent=null;for(var i=0;i<this.items.length;i++)
this.items[i]._index=i;},empty:function()
{for(var i=0;i<this.items.length;i++)
{var item=this.items[i];if(item.isRendered())
item.skin.remove();item.parent=null;}
this.items=[];},clear:function()
{for(var i=0;i<this.items.length;i++)
{var item=this.items[i];if(item.isRendered())
item.skin.remove();item.parent=null;}
this.items=[];},each:function(func,context)
{if(context)
jQuery.each(this.items,function(){func.apply(context,arguments)});else
jQuery.each(this.items,func);}})
Tea.Container.Skin=Tea.Element.Skin.subclass('Tea.Container.Skin',{render:function(source)
{var source=Tea.Container.Skin.supertype.render.call(this,source);var items=this.element.items;for(var i=0;i<items.length;i++)
this.append(items[i].render());return source;},onAddSource:function(src)
{},append:function(src)
{this.source.append(src);this.onAddSource(src);},prepend:function(src)
{this.source.prepend(src);this.onAddSource(src);},after:function(pivot,src)
{pivot.after(src);this.onAddSource(src);}})
Tea.Panel=Tea.Container.subclass('Tea.Panel',{options:{title:'',closable:false,top:null,bottom:null},setTitle:function(title)
{this.title=title;if(this.isRendered())
this.skin.setTitle(title);else
this.title=title;},getTitle:function()
{return this.title;},close:function()
{this.trigger('close');},focus:function(){this.skin.focus();},blur:function(){this.skin.blur();},hasFocus:function(){return this.skin.hasFocus();}});Tea.Panel.focus=null;Tea.Panel.Skin=Tea.Container.Skin.subclass('Tea.Panel.Skin',{options:{cls:'t-panel'},render:function(){var element=this.element;this.content=$("<div class='t-content'/>");this.title=$("<div class='t-title'/>").append(element.title||'');var anchor=this.anchor=$("<a class='t-focuser' href='#'>&#160;</a>");anchor.has_focus=false;this.anchor.bind('focus',function(){anchor.has_focus=true;element.source.addClass('t-focus');element.trigger('focus')
Tea.Panel.focus=element;});this.anchor.bind('blur',function(){anchor.has_focus=false;element.source.removeClass('t-focus');element.trigger('blur')
Tea.Panel.focus=null;});Tea.Panel.Skin.supertype.render.call(this);this.source.append(this.anchor);this.source.append(this.title);this.source.append(this.content);this.setBars(element.top,element.bottom);if(element.closable)
this.closer=$("<div class='t-close t-icon CloseIcon'></div>").appendTo(this.title).click(function(){element.close()});return this.source;},setTitle:function(title)
{this.title.empty().append(title);},setBars:function(top,bottom)
{if(top){this.top=new Tea.Container({cls:'t-bar t-top',items:top});this.top.panel=this.element;this.title.after(this.top.render());}
if(bottom)
{this.bottom=new Tea.Container({cls:'t-bar t-bottom',items:bottom});this.bottom.panel=this.element;this.content.after(this.bottom.render());}},append:function(src)
{this.content.append(src);},prepend:function(src)
{this.content.prepend(src);},setHTML:function(src)
{this.content.empty().append(src);},focus:function()
{if(!this.isRendered())
{var self=this;setTimeout(function(){self.anchor.focus();});}
this.anchor.focus();},blur:function()
{this.anchor.blur();},hasFocus:function(){return this.anchor.hasFocus;}});Tea.Panel.WindowSkin=Tea.Panel.Skin.subclass('Tea.Panel.WindowSkin',{options:{cls:'t-window t-panel'}})
Tea.Dialog=Tea.Panel.subclass('Tea.Dialog',{options:{placement:'top',opacity:1,easing:'swing',speed:'normal',appendTo:null,time:null},show:function()
{if(!this.isRendered())
this.render();this.skin.show();return this.source;},hide:function()
{this.skin.hide();}})
Tea.Dialog.Skin=Tea.Panel.Skin.subclass('Tea.Dialog.Skin',{options:{cls:'t-dialog t-panel'},show:function()
{var element=this.element;var source=this.source;source.appendTo(element.appendTo||document.body);source.show();source.css('opacity',0);source.css('position','absolute');source.css('top',-source.height());source.css('left',$(document).width()/2-source.width()/2);if(element.placement=='top')
source.animate({top:20,opacity:element.opacity},element.speed,element.easing);else if(element.placement=='center')
source.animate({top:$(document).height()/2.5-source.height()/2,opacity:element.opacity},element.speed,element.easing);if(element.time)
{var self=this;setTimeout(function(){self.hide()},element.time);}},hide:function()
{var self=this;var source=this.source;source.fadeOut(this.element.speed,function(){source.remove()});}})
Tea.Form=Tea.Container.subclass('Tea.Form',{options:{url:null,success:null,callback:null,dataType:'json',context:null,method:'post',submit:null,focus:true,value:null,processor:null,upload:false,type:'ajax'},__init__:function()
{this.fields={};Tea.Form.supertype.__init__.apply(this,arguments);},own:function(item)
{item=Tea.Form.supertype.own.call(this,item);if(item.name)
this.fields[item.name]=item;return item;},_submit:function(options)
{if(this.type=='iframe')
{this.trigger('submit');return true;}
var data={};this.each(function(){if(this.name)data[this.name]=this.getValue()});if(this.filter)
data=this.filter.call(this.context||this,data);if(this.submit)
{try{return this.submit.call(this.context||this,data);}catch(e){console.error(e);return false;}}
var options=jQuery.extend({method:this.method,success:this.success,invalid:this.invalid,context:this.context||this,data:data,dataType:this.dataType,url:this.url},options);Tea.ajax(options);return false;},submit:function(options)
{return this.source.submit();},invalid:function(response)
{this.setErrors(response.__invalid__);},setErrors:function(errors)
{for(var key in errors)
{if(this.fields[key])
this.fields[key].setErrors(errors[key]);}},getErrors:function()
{var gather={};for(var key in this.fields)
gather[key]=this.fields[key].getErrors();return gather;},clearErrors:function()
{for(var key in this.fields)
this.fields[key].clearErrors();},setValue:function(value)
{for(var key in this.fields)
if(value[key]!=undefined)
this.fields[key].setValue(value[key]);},getValue:function()
{var gather={};for(var key in this.fields)
gather[key]=this.fields[key].getValue();return gather;},validate:function()
{return true;},focus:function()
{for(var key in this.fields)
{if(this.fields[key].name)
return this.fields[key].source.focus();}}});Tea.Form.iframeCount=0;Tea.Form.Skin=Tea.Container.Skin.subclass('Tea.Form.Skin',{options:{cls:'t-form'},render:function(source)
{var element=this.element;var source=source||$('<form/>').attr('method',element.method).attr('action',element.url||'.');if(element.upload)
source.attr('enctype',"multipart/form-data");if(element.type=='iframe')
{var iframe=$('<iframe class="t-hidden" src="#" style="width:0;height:0;border:0px solid #fff;"/>');var id="upload-iframe-"+(Tea.Form.iframeCount++);iframe.attr('name',id).attr('id',id);source.append(iframe);source.attr('target',id);iframe.bind('load',function()
{var msg=$(iframe[0].contentDocument.body).html();element.success.call(element.context||element,msg);return true;});}
source=Tea.Form.Skin.supertype.render.call(this,source);source.submit(function(){if(!element.validate())return false;if(element.type=='classic')return true;return element._submit();});source.append('<input type="submit" style="display: none;"/>');if(element.value)
element.setValue(element.value);return source;}});Tea.Field=Tea.Element.subclass('Tea.Field',{options:{name:null,value:null,label:null,skin:'Tea.Field.Skin'},__init__:function()
{Tea.Field.supertype.__init__.apply(this,arguments);this.name=this.name;this.type=this.type;this.label=this.label;this.model=(this.model?Tea.getClass(this.model):null);this.errors=null;this.field=null;this._value=null;},getField:function()
{throw new Error("Abstract base class Tea.Field has no implimentation for getField().");},getLabel:function()
{return jQuery('<label/>').append(this.label||this.name);},getValue:function()
{var v=null;if(this.field)
v=this.field.val();else
v=this._value;if(this.model)
return this.model.get(v);return v;},setValue:function(v)
{if(this.model)
v=v.pk;if(this.field)
this.field.val(v);this._value=v;},focus:function()
{this.skin.focus();},blur:function()
{this.skin.blur();},setErrors:function(error_list)
{if(typeof error_list=='string')
error_list=[error_list];this.errors=error_list;this.source.addClass('t-error');},clearErrors:function()
{this.source.removeClass('t-error');},getErrors:function()
{throw new Error("Not Implimented.");},validate:function()
{}});Tea.Form.prototype.classes=Tea.Field;Tea.Field.Skin=Tea.Element.Skin.subclass('Tea.Field.Skin',{options:{cls:'t-field'},render:function()
{var element=this.element;this.label=element.label=element.getLabel();this.field=element.field=element.getField();Tea.Field.Skin.supertype.render.call(this);if(element._value)
element.setValue(element._value);else if(element.value)
element.setValue(element.value);if(this.label)
this.source.append(this.label);this.source.append(this.field);if(element.hidden)
this.source.hide();if(element.field_attrs)
for(a in element.field_attrs)
this.field.attr(a,element.field_attrs[a]);if(this._focus)
this.field.focus();return this.source;},focus:function()
{if(this.source)
this.field.focus();else
this._focus=true;},blur:function()
{if(this.source)
this.field.blur();else
this._focus=false;}})
Tea.Field.text=Tea.Field.subclass('Tea.Field.text',{getField:function(){return $('<input type="text"/>').attr('name',this.name)}})
Tea.Field.hidden=Tea.Field.subclass('Tea.Field.hidden',{options:{hidden:true},getLabel:function(){return null;},getField:function(){return $('<input type="hidden"/>').attr('name',this.name)}})
Tea.Field.password=Tea.Field.subclass('Tea.Field.password',{getField:function(){return $('<input type="password"/>').attr('name',this.name)}})
Tea.Field.checkbox=Tea.Field.subclass('Tea.Field.checkbox',{getField:function(){return $('<input type="checkbox"/>').attr('name',this.name)},getValue:function(){return this.field.attr('checked')},setValue:function(v){return this.field.attr('checked',v?'checked':'')}})
Tea.Field.textarea=Tea.Field.subclass('Tea.Field.textarea',{getField:function(){return $('<textarea/>').attr('name',this.name)}})
Tea.Field.static=Tea.Field.subclass('Tea.Field.static',{getField:function(){return $('<div class="t-static"/>').attr('name',this.name)},getValue:function()
{var v=this._value;if(this.field)v=this.field[0].innerHTML;if(this.model)
return this.model.get(v);return v;},setValue:function(v)
{if(this.model)
v=v.pk;if(this.field)
this.field[0].innerHTML=v;this._value=v;}})
Tea.Field.select=Tea.Field.subclass('Tea.Field.select',{getField:function(){this.choices=this.choices;var field=$('<select/>').attr('name',this.name);this.values={};this.indexes={};for(var i=0;i<this.choices.length;i++)
{var display,value=this.choices[i];if(value.constructor===Array)
{display=value[0];value=value[1];}
else
{display=value;}
var option=$('<option>'+display+'</option>');field.append(option);this.values[i]=value;this.indexes[value]=i;}
return field;},getValue:function()
{var v;if(this.field)
v=this.values[this.field[0].selectedIndex];else
v=this.values[this._value];if(this.model)
v=this.model.get(v).getRef();return v;},setValue:function(v)
{if(v._model)
v=v._pk;if(this.field)
this.field[0].selectedIndex=this.indexes[v];this._value=this.indexes[v];}})
Tea.Field.object=Tea.Field.subclass('Tea.Field.object',{options:{skin:null,delay:340,minLength:1,pool:null},getField:function(){this.timeout=null;this.search_item=$('<div class="t-item"></div>')
this.search_item.icon=$('<div class="t-icon SearchIcon"/>').appendTo(this.search_item);this.search_item.input=$('<input type="text" class="t-name" autocomplete="no"/>').appendTo(this.search_item);var self=this;this.search_item.input.bind('keydown',function(e){self.onKeyup(e)});this.search_item.input.bind('blur',function(e){self.hideList()});this.search_item.input.bind('focus',function(e){self.onChange()});var field=$('<div class="t-object t-medium">').attr('name',this.name).append(this.search_item);return field;},getValue:function()
{return this.value;},setValue:function(v)
{if(this.value_item)
this.value_item.source.remove();if(v==null)
{this.search_item.show();this.value=null;return;}
var self=this;this.value=Tea.Model.get(v);this.value_item=this.value.getListItem({cls:'t-object-field-value',onDrop:function(item)
{var value=item.getValue();if(value._model=='auth.User'||value._model=='auth.Group')
{self.setValue(value);}}});this.search_item.hide();this.field.append(this.value_item.render());this.value_item.show();this.value_item.source.bind('click',function()
{self.setValue(null);self.search_item.input.focus();})},onKeyup:function(e)
{var code=e.keyCode;var val=this.search_item.input.val();if(code==38)
{this.showList();this.list.hoverPrev();return e.preventDefault();}
if(code==40)
{this.showList();this.list.hoverNext();return e.preventDefault();}
if(code==9||code==13)
{this.showList();this.list.hoverSelect();return e.preventDefault();}
if(code==27)
{this.hideList();e.stopPropagation();return e.preventDefault();}
if(this.timeout)clearTimeout(this.timeout);var val=this.search_item.input.val();if(val.length<this.minLength)
return this.hideList();var self=this;this.timeout=setTimeout(function(){self.onChange(e)},this.delay);return;},onChange:function(e)
{var term=this.search_item.input.val();if(term.length<this.minLength)
return this.hideList();this.showList();this.list.resource.updateParams({term:term});this.list.refresh();},showList:function()
{if(this.list)
return this.list.show();if(!this.list)
{this.pool=this.pool;this.list=new Tea.List({cls:'t-dropdown',value:this.pool,onSelect:function()
{try{this.setValue(this.list.selected.getValue());}catch(e){console.error(e)}
this.hideList();},context:this})
var dim={w:this.field.width(),h:this.field.height()}
var src=this.list.render().appendTo(this.field).css({top:dim.h,width:dim.w});var self=this;this.list.bind('value',function()
{self.list.setHover(0);})}
this.list.show();},hideList:function()
{if(this.list)
this.list.hide();}})
Tea.Field.object.Skin=Tea.Field.Skin.subclass('Tea.Field.object.Skin',{options:{cls:'t-field t-object-field'}})
Tea.Drag=Tea.Class('Tea.Drag',{__init__:function(options)
{Tea.Drag.supertype.__init__.call(this,options);this.active=null;var self=this;$(document.body).mousemove(function(e){if(self.active)
self.active.update(e);});$(document.body).mouseup(function(e){if(self.active)
self.active.end(e);});this.overlay=$('.t-overlay');if(this.overlay.length==0)
this.overlay=$('<div class="t-overlay t-medium"/>').appendTo(document.body).hide();Tea.Drag=this;},init:function(){}})
Tea.Drag.init=function()
{if(typeof Tea.Drag=='function')
new Tea.Drag();}
Tea.Draggable=Tea.Class('Tea.Draggable',{options:{cls:null,ghost:null,threshold:5,snapToCursor:true},attach:function(element)
{Tea.Drag.init();var self=this;element.source.bind('mousedown',function(e){if(element.options.drag_locked)
return;Tea.Drag.active=self;self.origin={left:e.clientX,top:e.clientY};self.element=element;self.begun=false;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();});},createGhost:function(element)
{var source=element.source;return source.clone().css('opacity',.5).appendTo(document.body).css('position','absolute').width(source.width()).height(source.height()).addClass('t-drag').appendTo(Tea.Drag.overlay);},start:function(e)
{this.ghost=this.createGhost(this.element);this.target=null;this.overlay=Tea.Drag.overlay;var offset=this.element.source.offset();this.delta={top:this.origin.top-offset.top,left:this.origin.left-offset.left}
Tea.Drag.overlay.show();Tea.deselect();this.begun=true;},update:function(e)
{if(!this.begun)
{var d1=Math.abs(e.clientX-this.origin.left);var d2=Math.abs(e.clientY-this.origin.top);if(d1<this.options.threshold||d2<this.options.threshold)
return;this.start(e);}
if(this.options.snapToCursor)
{var left=e.clientX+10;var top=e.clientY-this.ghost.height()/2;}
else
{var left=e.clientX-this.delta.left;var top=e.clientY-this.delta.top;}
Tea.Drag.overlay.css('left',left).css('top',top);},end:function(e)
{if(this.ghost)
this.ghost.remove();if(this.target)
{this.target.trigger('drop',this.element);if(this.target.options.onDrop)
this.target.options.onDrop.call(this.target,this.element);}
else
this.element.trigger('drop-nowhere');Tea.Drag.overlay.hide();Tea.Drag.active=null;}})
Tea.Droppable=Tea.Class('Tea.Droppable',{options:{accept:[]},attach:function(element)
{var cursor;var onMouseOver=function(e)
{if(Tea.Drag.active)
{cursor=element.source.css('cursor');element.source.css('cursor','move');Tea.Drag.active.target=element;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();}};var onMouseOut=function(e)
{if(cursor)
{element.source.css('cursor',cursor);cursor=null;}
if(Tea.Drag.active)
Tea.Drag.active.target=null;}
element.source.hover(onMouseOver,onMouseOut);}})
Tea.StackContainer=Tea.Container.subclass('Tea.StackContainer',{options:{columns:3,space:4,column_width:350},__init__:function()
{this.paused=1;Tea.StackContainer.supertype.__init__.apply(this,arguments);},render:function(source)
{var self=this;setTimeout(function(){self.refresh()},100);this.paused=0;return Tea.StackContainer.supertype.render.call(this,source);},append:function(item)
{return this.push(item);},insert:function(pos,item)
{Tea.StackContainer.supertype.insert.call(this,pos,item);this.refresh(item);},push:function(item,after)
{if(after)
{this.pause();this.popAfter(after);this.play();}
item=Tea.StackContainer.supertype.append.call(this,item);this.refresh(item);},pop:function(item)
{if(item)
{if(item.parent!==this)throw new Error("Popping an item that isn't in the Tea.StackContainer.");for(var i=item._index;i<this.items.length;i++)
{if(this.items[i].source)
this.items[i].skin.remove();item.parent=null;}
this.items.splice(item._index,this.items.length-item._index);}
else
{var item=this.items[this.items.length-1];Tea.StackContainer.supertype.remove.call(this,item);}
this.refresh();return item;},remove:function(item)
{this.pop(item);},popAfter:function(item)
{var next=this.items[item._index+1];if(next)
this.pop(next);},refresh:function(panel)
{if(!this.skin||this.paused>0)return;this.skin.refresh(panel);},pause:function()
{this.paused+=1;},play:function()
{this.paused-=1;}})
Tea.StackContainer.Skin=Tea.Container.Skin.subclass('Tea.StackContainer.Skin',{options:{cls:'t-stack'},refresh:function(new_item)
{var element=this.element;var i,k,item;var len=element.items.length;var hidden=[];var shown=[];var sz=element.options.columns;for(i=0;i<len;i++)
{item=element.items[len-i-1];if(sz>0)
{shown.push(item);sz-=(item.options.size||1);if(item.options.size==2)
item.source.addClass('t-wide')}
else
hidden.push(item);}
shown.reverse();var width=(element.source.width()/element.options.columns)-(element.options.space/2);for(var i=0;i<hidden.length;i++)
hidden[i].source.hide().css('left',-width+50);k=0;for(var i=0;i<shown.length;i++)
{var item=shown[i];var size=item.options.size||1;var left=((width+element.options.space)*k);if(item==new_item)
item.source.css({left:left,opacity:0,width:width*size});item.source.show().css({position:'absolute',width:width*size}).animate({left:left,opacity:1});k+=item.options.size||1;}}})
Tea.StackContainer.StretchySkin=Tea.StackContainer.Skin.subclass("Tea.StackContainer.Stretchy",{options:{buffer:100,scrollParent:window},render:function()
{var result=Tea.StackContainer.StretchySkin.supertype.render.apply(this,arguments);$(window).resize(Tea.method(this.onResize,this));$(window).scroll(Tea.metronome(300,this.onScroll,this));$(window).scroll(Tea.metronome(300,this.onResize,this));return result;},refresh:function(new_item)
{var result=this.__super__(new_item);if(new_item)
this.correct(new_item);return result;},onResize:function()
{var width=this.source.parent().width()||this.source.width();this.element.options.columns=parseInt(width/this.element.options.column_width);this.refresh();},correct:function(item)
{if(item.options.title=='Tea')return;var fold=$(this.options.scrollParent).scrollTop();var height=$(this.options.scrollParent).height();var s=item.source;var buffer=this.options.buffer;var top=s.offset().top;var bottom=s.offset().top+s.height();var b_delta=bottom-(fold+$(window).height());var t_delta=fold-top;var new_top=null;if(b_delta>0)
new_top=top-b_delta;if(s.height()>height)
{if(t_delta<0)
new_top=fold;}
else
{if(t_delta!=0)
new_top=fold;}
if(new_top!=null)
{new_top=new_top-this.source.offset().top;if(new_top<0)
new_top=0
s.animate({top:new_top},'fast');}},onScroll:function()
{this._scrolltimeout
var self=this;this.element.each(function()
{self.correct(this);});}})
Tea.Model=function(name,properties)
{if(!properties)properties={};if(typeof name!='string')throw new Error("Must provide a string <name> to Tea.Model(name, properties).");return Tea.Model.subclass(Tea.Model.Base,name,properties);}
Tea.Model.subclass=function(Base,name,properties)
{if(!properties)properties={};if(typeof name!='string')throw new Error("Must provide a string <name> to Tea.Model.subclass(name, properties).");properties.__class__=jQuery.extend({},Base.prototype.__class__,properties.__class__||{});var Model=Tea.Model.Base.subclass(name,properties);jQuery.extend(Model,properties.__class__);Model.subclass=function(name,properties){return Tea.Model.subclass(Model,name,properties)}
Model.cache={};return Model;}
Tea.Model.Base=Tea.Class('Tea.Model',{__class__:{get:function(pk,value)
{if(value)
value._pk=pk;else if(typeof pk=='object')
value=pk;else
value={_pk:pk};var existing=this.cache[value._pk];if(existing)
return existing.setValue(value);return new this(value);},query:function(override)
{var options={url:this.prototype.options.url+'search/'}
return Tea.ajax(options,override);},getSearchResource:function(options)
{var name=this.id+".SearchResource"
var Model=this;if(!Tea.classes[name])
{Tea.classes[name]=Tea.Resource.subclass(name,{options:{url:Model.prototype.options.url+'search/'},setValue:function(data)
{this.value=[];for(var i=0;i<data.length;i++)
{var o=Model.get(data[i]);this.value.push(o);}}});}
return new Tea.classes[name](options);}},__init__:function(value)
{value=value||{};value._pk=value._pk||null;this.setValue(value);this._model=this.constructor.id;},options:{url:null,item:{type:"Tea.ListItem"}},update:function(options)
{var standard={url:this.options.url,get:this.getRef(),context:this,success:function(data)
{this._pk=data.pk;this._model=data.model;this.setValue(data.value);this.trigger('updated',data.value);},invalid:function(errors)
{this.trigger('invalid',errors);}};Tea.ajax(jQuery.extend(standard,options));},save:function(options)
{var data={value:Tea.toJSON(this.getValue())};if(this.__errors__!=undefined)
delete this.__errors__;var standard={url:this.options.url,post:this.getRef(data),context:this,success:function(data)
{this._pk=data.pk;this._model=data.model;this.setValue(data.value);this.trigger('updated',data.value);this.trigger('saved',data.value);},invalid:function(errors)
{this.__errors__=errors;this.trigger('invalid',errors);}};Tea.ajax(jQuery.extend(standard,options))},del:function(options)
{var standard={url:this.options.url,method:'get',context:this,get:this.getRef({action:'delete'}),success:function(deleted)
{this._pk=null;if(deleted)
this.trigger('deleted');},invalid:function(errors)
{this.trigger('invalid',errors);}};Tea.ajax(jQuery.extend(standard,options))},getRef:function(extend)
{var ref={model:this._model};if(this._pk!=null)ref.pk=this._pk
return $.extend(ref,extend);},getValue:function()
{var value={};for(var i in this)
{if(i=='options'||i[0]=='_')continue;var v=this[i];if(typeof v=='function')continue;if(v&&typeof v=='object'&&v.__class__!=null)v=v.getRef();value[i]=v;}
return value;},setValue:function(value)
{for(var k in value)
{var v=value[k];if(typeof v=='object'&&v!=null&&v._model!=null&&v._pk!=null)
this[k]=Tea.Model.get(v);else
this[k]=v;}
if(this._pk)
this.constructor.cache[this._pk]=this;this.trigger('changed');return this;},getFields:function()
{return[];},toString:function()
{return"<"+this._model+" "+this._pk+">";},getListItem:function(options)
{options=$.extend({},{value:this,template:this.options.template,type:'Tea.ListItem'},this.options.item,options);var item=Tea.manifest(options);var self=this;var update=function()
{item.refresh();}
this.bind('update',update);item.bind('drop',function(){if(self.onDrop)
self.onDrop.apply(self,arguments)});return item;}});Tea.Model.get=function(value)
{var model=Tea.getClass(value._model);if(!model)
throw new Error("Cannot find model: "+value._model);return model.get(value);}
Tea.Template=Tea.Class({options:{re:/{{\s*(.*?)\s*}}/g,html_encode:false,missing_throws:false},__init__:function(src,options)
{this.src=src;Tea.Template.supertype.__init__.call(this,options);},apply:function(context)
{var self=this;return this.src.replace(this.re,function(match,group,index,full)
{return self.getVar(group,context);});},getVar:function(variable,context)
{if(!variable)
throw new Error("Empty group in template.");var path=variable.split('.');var value=context;for(var i=0;i<path.length;i++)
{if(path[i]=='*')continue;value=value[path[i]];if(value==undefined)
if(this.missing_throws)
throw new Error("Unable to find variable in context: "+path.join("."));else
value='';}
if(this.html_encode)
value=value.replace(/&/g,'&amp;').replace(/\</g,'&lt;').replace(/\>/g,'&gt;');return value;}})
Tea.Testing={};Tea.Testing.suites=[];try
{console.log.prototype;}catch(e){fn=function(){};console={log:fn,group:fn,groupEnd:fn,error:fn,debug:fn}}
Tea.Testing.run=function(suite,test)
{Tea._testing=true;jQuery.ajaxSetup({async:false});var suites=Tea.Testing.suites;var count=0;var passed=0;console.log("Running tests...");for(var i=0;i<suites.length;i++)
{if(suite&&suites[i].name!=suite)continue;var results=suites[i].run(test);count+=results[0];passed+=results[1];}
if(count==passed)
console.log("Passed.");else
console.log("Failed: %s of %s passed.",passed,count);jQuery.ajaxSetup({async:true});Tea._testing=false;return{count:count,passed:passed};}
Tea.Testing.fail=function(msg)
{var e=new Error(msg);e.failure=true;throw e;}
function assertEqual(a,b,msg)
{if(a==b)return;if(a==undefined)a='undefined';if(b==undefined)b='undefined';Tea.Testing.fail(msg||("assertEqual failed: "+a.toString()+' != '+b.toString()));}
function assert(a,msg)
{if(a)return;Tea.Testing.fail(msg||'assertion failed.');}
Tea.Testing.Suite=Tea.Object.subclass('Tea.Testing.Suite',{__init__:function(attrs)
{this._tests=[];for(var k in attrs)
{this[k]=attrs[k];if(k=='teardown')continue;if(k=='setup')continue;if(k[0]=='_')continue;if(typeof attrs[k]=='function')
this._tests.push(new Tea.Testing.Test(k,attrs[k]));}
if(!this.name)
throw new Error("Unable to build test suite, it was not given a name attribute.");Tea.Testing.suites.push(this);},run:function(test)
{this._passed=0;console.group(this.name);if(this.setup)
{try{this.setup.call(this);}
catch(e){console.error('Error setting up suite.');console.error(e);console.groupEnd();return[1,0];}}
for(var i=0;i<this._tests.length;i++)
{if(test&&this._tests[i].name!=test)continue;this._tests[i].run(this,test==this._tests[i].name);}
if(this.teardown)
{try{this.teardown.call(this);}
catch(e){console.error('Error tearing down suite.');}}
if(this._passed==this._tests.length)
console.log("All of %s passed.",this._tests.length);else
console.log("%s of %s passed.",this._passed,this._tests.length);console.groupEnd();return[this._tests.length,this._passed];}});Tea.Testing.Test=Tea.Object.subclass('Tea.Testing.Test',{__init__:function(name,entry)
{this.name=name;this.entry=entry;this.status=null;this.comment=null;},run:function(suite,let)
{try
{this.entry.call(suite);this.status='.';suite._passed+=1;}
catch(e)
{pass=false;if(let)
throw e;if(e.failure)
{this.status='F';this.comment=e.message;console.error("%s Failed - %s: %s\n",this.name,e.name,e.message,Tea.Testing.trace(e));}
else
{this.status='E';this.comment=e.message;console.error("%s Threw - %s: %s\n",this.name,e.name,e.message,Tea.Testing.trace(e));}}}});Tea.Testing.trace=function(e)
{if(!e.stack)
return e.sourceURL+":"+e.line;var split=e.stack.split('\n');var frames=[];for(var i=0;i<split.length;i++)
{var frame=split[i];frames.push(frame.split('@').reverse().join(" - "));}
return frames.join("\n");}
Tea.Testing.setupAjax=function(responses)
{Tea.Testing.ajaxCalls=[];Tea.Testing._ajax=jQuery.ajax;jQuery.ajax=function(options)
{Tea.Testing.ajaxCalls.push(options);try{var response=responses[options.url](options);}catch(e){console.error("Unable to find url in the responses: %s",options.url);throw e;}
options.success.call(this,response);}}
Tea.Testing.teardownAjax=function()
{jQuery.ajax=Tea.Testing._ajax}
Tea.Widget={}
Tea.Button=Tea.Element.subclass('Tea.Button',{options:{text:'',icon:'',disabled:false,click:null,context:null},__init__:function()
{Tea.Button.supertype.__init__.apply(this,arguments);if(this.text)
this.setText(this.text);if(this.icon)
this.setIcon(this.icon);},render:function()
{Tea.Button.supertype.render.apply(this,arguments);this.setDisabled(this.disabled);if(this.text)
this.skin.setText(this.text);if(this.icon)
this.skin.setIcon(this.icon);return this.source;},setText:function(text)
{this.text=text;if(this.isRendered())
this.skin.setText(text);},getText:function()
{return this.text;},setIcon:function(icon)
{this.icon=icon;if(this.isRendered())
this.skin.setIcon(icon);},getIcon:function()
{return this.icon;},disable:function()
{this.setDisabled(true);},enable:function()
{this.setDisabled(false);},setDisabled:function(bool)
{this.disabled=bool;if(this.source)
this.skin.setDisabled(this.disabled=bool);else
this.disabled=bool;},click:function()
{if(this.disabled||typeof(this.click)!='function')return false;this.click.apply(this.context||this);}})
Tea.Button.Skin=Tea.Element.Skin.subclass('Tea.Button.Skin',{options:{cls:'t-button'},render:function(){var element=this.element;this.icon=$("<div class='t-icon'/>").addClass(element.icon);this.text=$("<div class='t-text'/>").append(element.text||'');Tea.Button.Skin.supertype.render.call(this);element.source.append(this.icon);element.source.append(this.text);element.source.mousedown(function(){if(!element.disabled)
element.source.addClass('t-active')});element.source.bind('mouseup mouseout',function(){element.source.removeClass('t-active')});if(element.click)
element.source.click(Tea.method(element.click,element));element.source.hover(function(){if(!element.disabled)
element.source.addClass('t-button-hover');},function(){element.source.removeClass('t-button-hover');})
return this.source;},setText:function(text)
{this.text.empty().append(text);},setIcon:function(icon)
{if(this.iconCls)
this.icon.removeClass(this.iconCls);this.icon.addClass(this.iconCls='icon-'+icon);},setDisabled:function(bool)
{if(bool)
this.source.addClass('t-disabled');else
this.source.removeClass('t-disabled');}});